 <!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Energ√≠a Colectiva - Corchea V5 (SVG exacta)</title>
  <meta name="theme-color" content="#4e0199" />
  <style>
    :root { --bg1:#4e0199; --bg2:#00b0ca; --fill:#00ffcc; }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(to bottom right, var(--bg1), var(--bg2));
      color: #fff; text-align: center; padding: 20px; overflow-x: hidden;
    }
    .logo { margin-top: 10px; max-width: 60vw; height: auto; }
    h1 { margin: 16px 0 8px; }
    .hint { font-size: 18px; margin-top: 8px; opacity: .9; }
    .controls { margin: 16px 0; display:flex; gap:12px; justify-content:center; flex-wrap:wrap; }
    .btn {
      appearance: none; border: 0; border-radius: 12px; padding: 12px 16px;
      font-weight: 600; cursor: pointer; background: rgba(255,255,255,.15);
      color: #fff; backdrop-filter: blur(6px);
    }
    .btn:focus { outline: 2px solid #fff; outline-offset: 2px; }

    /* ---- CORCHEA (progreso) ---- */
    .noteWrap {
      margin: 24px auto;
      width: min(80%, 420px);
      aspect-ratio: 450 / 675; /* del viewBox del SVG original */
      position: relative;
    }
    .noteWrap svg { width: 100%; height: 100%; display: block; }
    .noteOutline { stroke:#fff; stroke-width:6; fill:transparent; opacity:.9; }
    .noteBack { fill: rgba(255,255,255,.08); }
    .noteFill {
      fill: var(--fill);
      transform-box: fill-box;
      transform-origin: center bottom;
      transform: scaleY(0);
      transition: transform .25s ease-out;
    }

    .watts { font-size: 24px; margin-top: 12px; }
    .footer { margin-top: 40px; font-size: 14px; opacity: .7; }

    /* ---- CONFETTI MUSICAL ---- */
    .confetti { position: fixed; inset: 0; pointer-events: none; z-index: 9999; overflow: hidden; }
    .note { position: absolute; top: -10vh; animation: fall 2.2s linear both; }
    .glyph { display:inline-block; will-change: transform; animation: sway 1.2s ease-in-out infinite alternate; }

    @keyframes fall {
      0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
      100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
    }
    @keyframes sway {
      0% { transform: translateX(-10px) rotate(-10deg) scale(1); }
      100% { transform: translateX(10px) rotate(10deg) scale(1.05); }
    }

    @media (prefers-reduced-motion: reduce) {
      .note, .glyph { display: none !important; }
      .noteFill { transition: none; }
    }
    .sr { position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden; }
  </style>
</head>
<body>
  <img class="logo" src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/ed/Siemens_Energy_logo_2020.svg/2560px-Siemens_Energy_logo_2020.svg.png" alt="Siemens Energy" width="200" />
  <h1>¬°Activa tu Energ√≠a!</h1>
  <p class="hint">Sacude tu celular o toca el bot√≥n para llenar la corchea colectiva üéµ</p>

  <div class="controls">
    <button id="enableMotion" class="btn">‚öôÔ∏è Activar sensores</button>
    <button id="tapCharge" class="btn" title="Usar toque/teclado (Espacio)">üéµ Cargar</button>
    <button id="resetBtn" class="btn" title="Reinicia (R)">‚Ü∫ Reset</button>
  </div>

  <!-- Corchea (progreso) usando la silueta EXACTA del SVG -->
  <div
    class="noteWrap"
    role="progressbar"
    aria-label="Corchea colectiva"
    aria-valuemin="0"
    aria-valuemax="500"
    aria-valuenow="0"
  >
    <svg viewBox="0 0 450 675.000002" aria-hidden="true">
      <defs>
        <clipPath id="note-clip" clipPathUnits="userSpaceOnUse">
          <!-- paths importados del SVG -->
          <path d="M 254.207031 82.925781 C 255.757812 82.183594 257.5625 82 ... (recortado) ..." />
          <path d="M 257.550781 82.925781 C 259.101562 82.183594 260.90625 8 ... (recortado) ..." />
        </clipPath>
      </defs>

      <!-- Fondo leve para ver la forma desde 0% -->
      <g class="noteBackGroup">
        <path class="noteBack" d="M 254.207031 82.925781 C 255.757812 82.183594 257.5625 82 ... (recortado) ..." />
        <path class="noteBack" d="M 257.550781 82.925781 C 259.101562 82.183594 260.90625 8 ... (recortado) ..." />
      </g>

      <!-- Relleno recortado por la corchea -->
      <g clip-path="url(#note-clip)">
        <rect id="noteFill" class="noteFill" x="0" y="0" width="450" height="675.000002" />
      </g>

      <!-- Contorno -->
      <g class="noteOutlineGroup">
        <path class="noteOutline" d="M 254.207031 82.925781 C 255.757812 82.183594 257.5625 82 ... (recortado) ..." />
        <path class="noteOutline" d="M 257.550781 82.925781 C 259.101562 82.183594 260.90625 8 ... (recortado) ..." />
      </g>
    </svg>
  </div>

  <div class="watts"><span id="wattCounter">0</span> Watts generados</div>
  <div class="confetti" id="confettiContainer"></div>

  <p class="sr" aria-live="polite" id="live"></p>
  <div class="footer">Siemens Energy OpenDay 2025</div>

  <script>
    // --- Estado ---
    let watts = 0, displayWatts = 0;
    const maxWatts = 500;
    const noteFill = document.getElementById('noteFill');
    const wattCounter = document.getElementById('wattCounter');
    const confettiContainer = document.getElementById('confettiContainer');
    const live = document.getElementById('live');
    const btnEnable = document.getElementById('enableMotion');
    const btnTap = document.getElementById('tapCharge');
    const btnReset = document.getElementById('resetBtn');
    const progressEl = document.querySelector('.noteWrap');
    let celebrationTriggered = false;
    let lastAddTs = 0;

    const clamp = (v, a, b) => Math.max(a, Math.min(b, v));

    function animateUI() {
      if (displayWatts < watts) {
        const delta = Math.max(1, (watts - displayWatts) * 0.15);
        displayWatts = clamp(displayWatts + delta, 0, watts);
        updateProgress(displayWatts);
        requestAnimationFrame(animateUI);
      } else {
        updateProgress(displayWatts);
      }
    }

    function updateProgress(current) {
      const percent = Math.min((current / maxWatts) * 100, 100);
      noteFill.style.transform = `scaleY(${percent/100})`;

      wattCounter.textContent = Math.round(current);
      progressEl.setAttribute('aria-valuenow', Math.round(current));

      if (current >= maxWatts && !celebrationTriggered) {
        celebrationTriggered = true;
        live.textContent = '¬°Meta alcanzada!';
        triggerMusicConfetti();
        if (navigator.vibrate) navigator.vibrate([30, 40, 30]);
      }
    }

    function addEnergy(amount = 1) {
      if (celebrationTriggered) return;
      watts = clamp(watts + amount, 0, maxWatts);
      if (navigator.vibrate && watts % 25 === 0) navigator.vibrate(10);
      requestAnimationFrame(animateUI);
    }

    // ---- Confetti musical ----
    function triggerMusicConfetti() {
      const chars = ['‚ô™', '‚ô´', 'üéµ', 'üé∂'];
      const colors = ['#00ffcc', '#ffffff', '#ffd54f', '#c3f8ff'];
      const N = 70;

      for (let i = 0; i < N; i++) {
        const wrapper = document.createElement('div');
        wrapper.className = 'note';
        wrapper.style.left = Math.random() * 100 + 'vw';
        wrapper.style.animationDuration = (Math.random() * 1.5 + 1.6) + 's';

        const glyph = document.createElement('span');
        glyph.className = 'glyph';
        glyph.textContent = chars[(Math.random() * chars.length) | 0];
        glyph.style.fontSize = (Math.random() * 20 + 18) + 'px';
        glyph.style.animationDuration = (Math.random() * 1.2 + 0.8) + 's';
        glyph.style.color = colors[(Math.random() * colors.length) | 0];

        wrapper.appendChild(glyph);
        confettiContainer.appendChild(wrapper);

        setTimeout(() => wrapper.remove(), 4000);
      }
    }

    // --- Movimiento: iOS permiso + filtro gravedad ---
    let gravity = { x: 0, y: 0, z: 0 };
    const ALPHA = 0.8;
    const THRESH = 2.0;

    function onMotion(event) {
      const now = performance.now();
      const intervalOk = (now - lastAddTs) > 80;

      let ax, ay, az;
      if (event.acceleration && event.acceleration.x !== null) {
        ax = event.acceleration.x; ay = event.acceleration.y; az = event.acceleration.z;
      } else if (event.accelerationIncludingGravity) {
        const a = event.accelerationIncludingGravity;
        gravity.x = ALPHA * gravity.x + (1 - ALPHA) * a.x;
        gravity.y = ALPHA * gravity.y + (1 - ALPHA) * a.y;
        gravity.z = ALPHA * gravity.z + (1 - ALPHA) * a.z;
        ax = a.x - gravity.x; ay = a.y - gravity.y; az = a.z - gravity.z;
      } else {
        return;
      }

      const mag = Math.hypot(ax, ay, az);
      if (mag > THRESH && intervalOk && !celebrationTriggered) {
        const bonus = clamp((mag - THRESH) / 3, 0.5, 3);
        addEnergy(bonus);
        lastAddTs = now;
      }
    }

    async function enableMotionIfNeeded() {
      const needsPermission =
        typeof DeviceMotionEvent !== 'undefined' &&
        typeof DeviceMotionEvent.requestPermission === 'function';

      if (needsPermission) {
        btnEnable.style.display = '';
      } else {
        btnEnable.style.display = 'none';
        attachMotion();
      }
    }

    async function requestPermission() {
      try {
        const res = await DeviceMotionEvent.requestPermission();
        if (res === 'granted') {
          attachMotion();
          btnEnable.style.display = 'none';
        } else {
          alert('No se habilit√≥ el sensor. Usa üéµ Cargar o la tecla Espacio.');
        }
      } catch {
        alert('No se pudo pedir permiso al sensor.');
      }
    }

    function attachMotion() {
      window.addEventListener('devicemotion', onMotion, { once: false });
    }

    // --- Fallbacks & reset ---
    btnEnable.addEventListener('click', requestPermission);
    btnTap.addEventListener('click', () => addEnergy(2));
    btnReset.addEventListener('click', resetAll);

    window.addEventListener('keydown', (e) => {
      if (e.code === 'Space') { e.preventDefault(); addEnergy(2); }
      if (e.key.toLowerCase() === 'r') resetAll();
    });

    function resetAll() {
      watts = 0; displayWatts = 0; celebrationTriggered = false;
      updateProgress(0);
      live.textContent = 'Reiniciada.';
    }

    // Init
    updateProgress(0);
    enableMotionIfNeeded();
  </script>
</body>
</html>
