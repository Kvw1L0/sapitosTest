<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>SAP Rock God Challenge</title>
  <style>
    :root {
      --neon-blue: #00BFFF;
      --dark-background: #0d0221;
      --glow-color: #ffffff;
      --combo-color: #f1c40f;
      --rock-god-color: #ff00ff;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--dark-background);
      background-image: radial-gradient(circle at center, #241947 0%, var(--dark-background) 70%);
      color: white;
      text-align: center;
      padding: 20px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-around;
      min-height: 100vh;
      box-sizing: border-box;
      transition: background-color 0.3s;
    }

    body.rock-god-mode {
      animation: rockGodPulse 0.5s infinite;
    }

    @keyframes rockGodPulse {
      0%, 100% { background-color: var(--dark-background); }
      50% { background-color: #301a4e; }
    }

    /* --- Overlay --- */
    #overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(13, 2, 33, 0.9); backdrop-filter: blur(8px);
      z-index: 10000; display: flex; flex-direction: column;
      justify-content: center; align-items: center; padding: 25px;
      box-sizing: border-box; transition: opacity 0.5s ease-out;
    }
    #overlay.hidden { opacity: 0; pointer-events: none; }
    .overlay-content { max-width: 400px; }
    .overlay-content h2 { font-size: 28px; color: var(--neon-blue); text-shadow: 0 0 8px var(--neon-blue); }
    .overlay-content p { font-size: 18px; line-height: 1.6; }
    #startButton {
      margin-top: 25px; padding: 15px 30px; font-size: 20px; font-weight: bold;
      color: var(--dark-background); background-color: var(--neon-blue);
      border: none; border-radius: 10px; cursor: pointer;
      box-shadow: 0 0 15px var(--neon-blue), 0 0 25px var(--neon-blue);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    #startButton:hover { transform: scale(1.05); }

    /* --- Contenido Principal --- */
    .app-header { margin-bottom: 10px; }
    .logo { max-width: 140px; opacity: 0.9; cursor: pointer; }

    #combo-display {
      font-size: 3em; font-weight: bold;
      position: absolute; top: 25%;
      color: var(--combo-color);
      text-shadow: 0 0 10px var(--combo-color), 0 0 20px var(--combo-color);
      opacity: 0;
      transform: scale(0.5);
      transition: opacity 0.3s, transform 0.3s;
    }
    #combo-display.visible { opacity: 1; transform: scale(1); }

    .music-note-container {
      width: 80%; max-width: 180px;
      animation: breathing 4s ease-in-out infinite;
    }

    @keyframes breathing {
      0%, 100% { filter: drop-shadow(0 0 5px var(--glow-color)) drop-shadow(0 0 15px var(--glow-color)); transform: scale(1); }
      50% { filter: drop-shadow(0 0 10px var(--glow-color)) drop-shadow(0 0 25px var(--glow-color)); transform: scale(1.03); }
    }

    .beats { font-size: 24px; margin-top: 15px; text-shadow: 0 0 5px var(--glow-color); }
    .hint { font-size: 16px; margin-top: 5px; opacity: 0.7; }
    .footer { position: absolute; bottom: 10px; font-size: 12px; opacity: 0.4; }

    #rock-god-timer {
        position: absolute; bottom: 15%; font-size: 2em;
        font-weight: bold; color: var(--rock-god-color);
        text-shadow: 0 0 10px var(--rock-god-color); opacity: 0;
        transition: opacity 0.3s;
    }
    #rock-god-timer.visible { opacity: 1; }

    /* Canvas para Confeti */
    #confetti-canvas {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; z-index: 9999;
    }
  </style>
</head>
<body>

  <div id="overlay">
    <div class="overlay-content">
      <h2>Â¡AtenciÃ³n, Rockstar! ðŸŽ¸</h2>
      <p>Â¿Listo para el desafÃ­o? Â¡Sacude tu celular como si no hubiera un maÃ±ana! MantÃ©n el ritmo para multiplicar tus puntos y alcanzar el modo "Rock God". Â¡Llena la nota al mÃ¡ximo para ganar premios increÃ­bles!</p>
      <button id="startButton">Â¡A rockear!</button>
    </div>
  </div>
  
  <canvas id="confetti-canvas"></canvas>

  <header class="app-header">
    <img class="logo" id="logo" src="http://googleusercontent.com/file_content/0" alt="SAP Logo" />
  </header>
  
  <p class="hint">Â¡Agita para crear la melodÃ­a!</p>

  <div id="combo-display"></div>
  
  <div class="music-note-container">
    <svg id="elegantQuaver" viewBox="0 0 200 250" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="fillGradient" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop id="fillStop1" offset="100%" stop-color="var(--neon-blue)" />
          <stop id="fillStop2" offset="100%" stop-color="rgba(13, 2, 33, 0.1)" />
        </linearGradient>
      </defs>
      <path id="notePath"
        d="M 148.9,2.8 C 122.9,20.2 110.7,51 121.3,79.6 L 122.2,82.2 L 122.2,210 C 122.2,221.3 115,231.2 102.5,231.2 C 86,231.2 73.2,220.1 73.2,202.2 C 73.2,184.2 86,172.8 102.5,172.8 C 106.8,172.8 112.5,173.8 112.5,181.2 L 112.5,86.2 C 99.1,64.2 96.6,28.8 126.3,5.2 C 129.8,2.7 135.2,0.7 141.2,0.7 C 144.5,0.7 147,1.6 148.9,2.8 Z"
        fill="url(#fillGradient)" stroke="white" stroke-width="2" style="transition: fill 0.3s;" />
    </svg>
  </div>

  <div class="beats">
    <span id="beatCounter">0</span> Beats generados
  </div>

  <div id="rock-god-timer"></div>
  <div class="footer">SAP Rock God Challenge</div>

  <audio id="sound-drum" loop src="data:audio/mpeg;base64,SUQzBAAAAAAA..."></audio> <audio id="sound-bass" loop src="data:audio/mpeg;base64,SUQzBAAAAAAA..."></audio>
  <audio id="sound-guitar" loop src="data:audio/mpeg;base64,SUQzBAAAAAAA..."></audio>
  <audio id="sound-powerup" src="data:audio/mpeg;base64,SUQzBAAAAAAA..."></audio>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <script>
    // --- Elementos del DOM ---
    const DOMElements = {
        overlay: document.getElementById('overlay'),
        startButton: document.getElementById('startButton'),
        logo: document.getElementById('logo'),
        beatCounter: document.getElementById('beatCounter'),
        fillStop1: document.getElementById('fillStop1'),
        fillStop2: document.getElementById('fillStop2'),
        comboDisplay: document.getElementById('combo-display'),
        rockGodTimer: document.getElementById('rock-god-timer'),
        notePath: document.getElementById('notePath'),
        body: document.body,
        canvas: document.getElementById('confetti-canvas'),
    };

    // --- Audio ---
    const Sounds = {
        drum: new Audio('data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjQ1LjEwMAAAAAAAAAAAAAAA//tQxAADBQ0iAAAAAB9BRAABRGlwbG9tYSBvZiBTb3VuZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uQxAgCACDqAAAAExBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV'),
        bass: new Audio('data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjQ1LjEwMAAAAAAAAAAAAAAA//tQxAADBQ0iAAAAAB9BRAABRGlwbG9tYSBvZiBTb3VuZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uQxBEBABD2AAAAExBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV'),
        guitar: new Audio('data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjQ1LjEwMAAAAAAAAAAAAAAA//tQxAADBQ0iAAAAAB9BRAABRGlwbG9tYSBvZiBTb3VuZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uQxAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlMY3RoZSBjb3B5cmlnaHQgb2YgdGhlIHByZXNlbnQgcmVjb3JkaW5nIGlzIG93bmVkIGJ5IERpcGxvbWEgb2YgU291bmQuIEFsbCByaWdodHMgcmVzZXJ2ZWQuIFVuYXV0aG9yaXplZCBjb3B5aW5nLCByZXByb2R1Y3Rpb24sIGhpcmUgYnJvYWRjYXN0aW5nIGFuZCBwdWJsaWMgcGVyZm9ybWFuY2UgcHJvaGliaXRlZC4AVFVSTAAAAA8AAANQdWJsaXNoZXI6IERpcGxvbWEgb2YgU291bmQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uQxAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATEFNRSAzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV-GF2ZjU4LjQ1LjEwMM4A//uQxAAgAAADSAAAAExBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV-H'),
        powerup: new Audio('data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjQ1LjEwMAAAAAAAAAAAAAAA//tQxAADBQ0iAAAAAB9BRAABRGlwbG9tYSBvZiBTb3VuZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uQxCAECAFDVAAAAExBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV-H')
    };
    Object.values(Sounds).forEach(sound => { sound.loop = true; });
    Sounds.powerup.loop = false;

    // --- Estado de la App ---
    const AppState = {
        beats: 0,
        maxBeats: 5000, // Aumentado para dar mÃ¡s tiempo de juego
        celebrationTriggered: false,
        shakeEvents: 0,
        lastShakeTime: Date.now(),
        combo: 1,
        maxCombo: 4,
        isRockGodMode: false,
        logoTaps: 0,
        easterEggActive: false
    };

    // --- LÃ³gica del Juego ---
    const Game = {
        init() {
            DOMElements.startButton.addEventListener('click', this.start);
            DOMElements.logo.addEventListener('click', this.handleLogoTap);
            this.myConfetti = confetti.create(DOMElements.canvas, { resize: true });
        },

        start() {
            DOMElements.overlay.classList.add('hidden');
            Game.requestMotionPermissions();
            Object.values(Sounds).forEach(sound => {
                sound.play().catch(()=>{});
                sound.pause();
            });
            Sounds.powerup.play().catch(()=>{}); // Powerup sound
            Sounds.powerup.volume = 0;
        },

        requestMotionPermissions() {
            if (typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            window.addEventListener('devicemotion', this.handleMotion);
                        }
                    })
                    .catch(console.error);
            } else {
                window.addEventListener('devicemotion', this.handleMotion);
            }
        },
        
        handleLogoTap() {
            AppState.logoTaps++;
            if (AppState.logoTaps === 3) {
                AppState.easterEggActive = true;
                DOMElements.notePath.style.fill = 'url(#fillGradient)';
                DOMElements.fillStop1.setAttribute('stop-color', 'gold');
                alert('Easter Egg Activado!');
            }
        },

        handleMotion(event) {
            if (AppState.celebrationTriggered || AppState.isRockGodMode) return;
            const acc = event.accelerationIncludingGravity;
            const shakePower = Math.abs(acc.x) + Math.abs(acc.y) + Math.abs(acc.z);

            if (shakePower > 30) {
                const now = Date.now();
                if (now - AppState.lastShakeTime < 300) { // Menos de 300ms entre sacudidas
                    AppState.shakeEvents++;
                } else {
                    AppState.shakeEvents = 1;
                    AppState.combo = 1;
                }
                
                if (AppState.shakeEvents > 10 && AppState.combo < AppState.maxCombo) {
                    AppState.combo++;
                    AppState.shakeEvents = 0;
                    Game.vibrate([100, 50, 100]);
                }

                if (AppState.combo === AppState.maxCombo && !AppState.isRockGodMode) {
                    Game.startRockGodMode();
                    return;
                }

                AppState.lastShakeTime = now;
                const beatsToAdd = 1 * AppState.combo;
                AppState.beats = Math.min(AppState.beats + beatsToAdd, AppState.maxBeats);
                
                Game.updateUI();
                Game.manageAudio();
                Game.vibrate([50]);
            }
            Game.updateComboDisplay();
        },

        updateUI() {
            DOMElements.beatCounter.innerText = Math.floor(AppState.beats);
            let percent = 100 - Math.min((AppState.beats / AppState.maxBeats) * 100, 100);
            DOMElements.fillStop1.setAttribute('offset', percent + '%');
            DOMElements.fillStop2.setAttribute('offset', percent + '%');
            
            // Efecto de pulso en el fondo
            let pulseIntensity = Math.min(AppState.beats / AppState.maxBeats, 1);
            DOMElements.body.style.backgroundImage = `radial-gradient(circle at center, #241947 ${pulseIntensity*30}%, var(--dark-background) 70%)`;

            // Powerup sound
            Sounds.powerup.volume = Math.min(AppState.beats / AppState.maxBeats, 1);
            if (Sounds.powerup.paused) Sounds.powerup.play().catch(() => {});


            if (AppState.beats >= AppState.maxBeats && !AppState.celebrationTriggered) {
                Game.win();
            }
        },
        
        updateComboDisplay() {
            if (AppState.combo > 1) {
                DOMElements.comboDisplay.textContent = `x${AppState.combo}`;
                DOMElements.comboDisplay.classList.add('visible');
            } else {
                DOMElements.comboDisplay.classList.remove('visible');
            }
        },
        
        startRockGodMode() {
            AppState.isRockGodMode = true;
            DOMElements.body.classList.add('rock-god-mode');
            let timeLeft = 5;
            DOMElements.rockGodTimer.textContent = `Â¡ROCK GOD! ${timeLeft}`;
            DOMElements.rockGodTimer.classList.add('visible');
            Game.vibrate([200, 100, 200]);

            const rockGodInterval = setInterval(() => {
                timeLeft--;
                AppState.beats += AppState.maxBeats / 5; // Llenado rÃ¡pido
                Game.updateUI();
                Game.manageAudio();
                Game.vibrate([100]);
                DOMElements.rockGodTimer.textContent = `Â¡ROCK GOD! ${timeLeft}`;
                if (timeLeft <= 0) {
                    clearInterval(rockGodInterval);
                    AppState.isRockGodMode = false;
                    AppState.combo = 1;
                    AppState.shakeEvents = 0;
                    DOMElements.body.classList.remove('rock-god-mode');
                    DOMElements.rockGodTimer.classList.remove('visible');
                    Game.manageAudio(); // Apagar audio si es necesario
                }
            }, 1000);
        },

        manageAudio() {
            const progress = AppState.beats / AppState.maxBeats;
            if (progress > 0.01 && Sounds.drum.paused) Sounds.drum.play().catch(()=>{});
            if (progress > 0.25 && Sounds.bass.paused) Sounds.bass.play().catch(()=>{});
            if (progress > 0.50 && Sounds.guitar.paused) Sounds.guitar.play().catch(()=>{});

            // Si se detiene el movimiento
            clearTimeout(this.audioTimeout);
            this.audioTimeout = setTimeout(() => {
                Object.values(Sounds).forEach(s => s.pause());
            }, 300);
        },

        vibrate(pattern) {
            if ('vibrate' in navigator) {
                navigator.vibrate(pattern);
            }
        },

        win() {
            AppState.celebrationTriggered = true;
            Object.values(Sounds).forEach(sound => sound.pause());
            Game.vibrate([500, 200, 500]);
            this.launchConfetti();

            setTimeout(() => {
                window.location.href = 'https://forms.gle/VvtAHk7RNg5DyYM3A';
            }, 4000);
        },
        
        launchConfetti() {
            const duration = 3 * 1000;
            const animationEnd = Date.now() + duration;
            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

            function randomInRange(min, max) {
                return Math.random() * (max - min) + min;
            }

            const interval = setInterval(() => {
                const timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) return clearInterval(interval);

                const particleCount = 50 * (timeLeft / duration);
                this.myConfetti({ ...defaults, particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } });
                this.myConfetti({ ...defaults, particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } });
            }, 250);
        }
    };

    Game.init();
  </script>
</body>
</html>
