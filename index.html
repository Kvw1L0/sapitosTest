<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MelodÃ­a Colectiva</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom right, #2c3e50, #3498db);
      color: white;
      text-align: center;
      padding: 20px;
      overflow-x: hidden;
    }

    .logo {
      margin-top: 10px;
      max-width: 200px;
      opacity: 0.8;
    }

    .music-note-container {
      margin: 30px auto;
      width: 80%;
      max-width: 250px; /* Ajustado para la forma de la nota */
    }

    #quaverNote path {
      stroke: white;
      stroke-width: 5;
    }
    
    .beats {
      font-size: 24px;
      margin-top: 20px;
    }

    .hint {
      font-size: 18px;
      margin-top: 20px;
    }

    .footer {
      margin-top: 50px;
      font-size: 14px;
      opacity: 0.6;
    }

    .confetti {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
    }

    .note {
      position: absolute;
      font-size: 32px;
      animation: fall 3s linear infinite;
      color: #f1c40f; /* Color dorado para las notas */
    }

    @keyframes fall {
      0% { transform: translateY(-10vh) rotate(0); opacity: 1; }
      100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
    }
  </style>
</head>
<body>
  <h1>Â¡Crea la MelodÃ­a!</h1>
  <p class="hint">Sacude tu celular para componer la melodÃ­a colectiva ðŸŽ¶</p>

  <div class="music-note-container">
    <svg id="quaverNote" viewBox="0 0 100 150" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="fillGradient" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop id="fillStop1" offset="100%" stop-color="#2ecc71" />
          <stop id="fillStop2" offset="100%" stop-color="rgba(255, 255, 255, 0.1)" />
        </linearGradient>
      </defs>
      <path d="M 62.5,3.125 C 75.75,11.875 75,24.25 75.625,37.5 L 75.625,106.25 C 75.625,120.75 62.5,125 50,125 C 34.375,125 25,119.375 25,106.25 C 25,93.75 35.625,87.5 50,87.5 C 53.125,87.5 59.375,88.125 59.375,93.75 L 59.375,3.125 L 62.5,3.125 z" 
            fill="url(#fillGradient)" />
    </svg>
  </div>

  <div class="beats">
    <span id="beatCounter">0</span> Beats generados
  </div>

  <div class="confetti" id="confettiContainer"></div>

  <div class="footer">Music Jam Session 2025</div>

  <script>
    let beats = 0;
    const maxBeats = 500;
    const fillStop1 = document.getElementById('fillStop1');
    const fillStop2 = document.getElementById('fillStop2');
    const beatCounter = document.getElementById('beatCounter');
    const confettiContainer = document.getElementById('confettiContainer');
    let celebrationTriggered = false;

    function updateNoteFill() {
      // Calcula el porcentaje y lo invierte (100% -> 0%, 0% -> 100%)
      // porque el degradado se llena desde el punto de offset hacia abajo.
      let percent = 100 - Math.min((beats / maxBeats) * 100, 100);
      const percentString = percent + '%';
      
      fillStop1.setAttribute('offset', percentString);
      fillStop2.setAttribute('offset', percentString);
      
      if (beats >= maxBeats && !celebrationTriggered) {
        celebrationTriggered = true;
        triggerMusicConfetti();
      }
    }

    function triggerMusicConfetti() {
      const musicNotes = ['ðŸŽµ', 'ðŸŽ¶', 'ðŸŽ¼', 'ðŸŽ¹'];
      for (let i = 0; i < 60; i++) {
        const note = document.createElement('div');
        note.classList.add('note');
        note.style.left = Math.random() * 100 + 'vw';
        note.style.animationDuration = (Math.random() * 2 + 2) + 's'; // DuraciÃ³n entre 2 y 4 segundos
        note.style.fontSize = (Math.random() * 24 + 24) + 'px';
        note.textContent = musicNotes[Math.floor(Math.random() * musicNotes.length)];
        confettiContainer.appendChild(note);

        setTimeout(() => note.remove(), 4000);
      }
    }

    if (window.DeviceMotionEvent) {
      window.addEventListener('devicemotion', (event) => {
        const acc = event.accelerationIncludingGravity;
        const shakePower = Math.abs(acc.x) + Math.abs(acc.y) + Math.abs(acc.z);

        if (shakePower > 30 && !celebrationTriggered) {
          beats = Math.min(beats + 1, maxBeats);
          beatCounter.innerText = beats;
          updateNoteFill();
        }
      });
    } else {
      alert('Tu dispositivo no soporta el sensor de movimiento.');
    }
  </script>
</body>
</html>

